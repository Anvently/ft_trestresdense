
<div class="container mt-5">
	<div class="row">
		<div class="col-md-6 offset-md-3">
			<ul class="nav nav-tabs" id="authTabs" role="tablist">
				<li class="nav-item" role="presentation">
					<button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">Connexion</button>
				</li>
				<li class="nav-item" role="presentation">
					<button class="nav-link" id="signup-tab" data-bs-toggle="tab" data-bs-target="#signup" type="button" role="tab" aria-controls="signup" aria-selected="false">Inscription</button>
				</li>
			</ul>
			<div class="tab-content" id="authTabsContent">
				<div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
					<form id="loginForm" class="mt-3">
						<div class="mb-3">
							<label for="loginUsername" class="form-label">Nom d'utilisateur</label>
							<input type="text" class="form-control" id="loginUsername" required>
						</div>
						<div class="mb-3">
							<label for="loginPassword" class="form-label">Mot de passe</label>
							<input type="password" class="form-control" id="loginPassword" required>
						</div>
						<div id="error-message-connection-failed" class="form-errors alert alert-danger" style="display: none;"></div>
						<button type="submit" class="btn btn-primary">Se connecter</button>
					</form>
					<hr>
					<button id="login42" class="btn btn-secondary">Se connecter avec 42</button>
				</div>
				<div class="tab-pane fade" id="signup" role="tabpanel" aria-labelledby="signup-tab">
					<form id="signupForm" class="mt-3">
						<div class="mb-3">
							<label for="signupUsername" class="form-label">Nom d'utilisateur</label>
							<input type="text" class="form-control" id="signupUsername" required>
						</div>
						<div class="mb-3">
							<label for="signupEmail" class="form-label">Email</label>
							<input type="email" class="form-control" id="signupEmail" required>
						</div>
						<div class="mb-3">
							<label for="signupPassword" class="form-label">Mot de passe</label>
							<input type="password" class="form-control" id="signupPassword" required>
						</div>
						<button type="submit" class="btn btn-primary">S'inscrire</button>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

<script>

function init_login() {
	const loginForm = document.getElementById('loginForm');
	if (loginForm) {
		loginForm.addEventListener('submit', function(e) {
			e.preventDefault();
			const username = document.getElementById('loginUsername').value;
			const password = document.getElementById('loginPassword').value;
			
			// Remplacez 'YOUR_LOGIN_ENDPOINT' par l'URL réelle de votre endpoint de connexion
			fetch('https://localhost:8083/api/auth/login/', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({ username: username, password: password }),
			})
			.then((response) => 
				response.json()
				.then((data) => {
					if (response.status == 200) {
						// Connexion réussie
						console.log('Connexion réussie');
						// Rediriger vers la page principale ou effectuer d'autres actions
						window.location.hash = '#matchmaking';
					} else {
						// Échec de la connexion
						console.error('Échec de la connexion:', data);
						// Afficher un message d'erreur à l'utilisateur
						const errorDiv = document.getElementById('error-message-connection-failed');
						errorDiv.style.display = 'block';
						errorDiv.innerHTML = data;
					}
				})
			)
			.catch((e) => {
				console.error('Erreur lors de la connexion:', error);
				alert('Une erreur s\'est produite lors de la tentative de connexion.');
			});
		});

		const signupForm = document.getElementById('signupForm');
		if (signupForm) {
			signupForm.addEventListener('submit', function(e) {
				e.preventDefault();
				// ... (le reste du code de connexion)
			});
		}

		const login42Button = document.getElementById('login42');
		if (login42Button) {
			login42Button.addEventListener('click', function() {
				// Redirection vers l'authentification 42
				window.location.href = 'https://api.intra.42.fr/oauth/authorize?client_id=u-s4t2ud-7b58cca1aa55dd25c0845e50d85160e19d51224f609b8d441d4b6281473ba7ee&redirect_uri=https%3A%2F%2Flocalhost%3A8083%2Fapi%2Fauth%2F42-api-callback&response_type=code';
			});
		}
	}
}

registerCleanup('login', () => {
		console.log("cleaning login page");
});

registerInit('login', () => {
		console.log("init login page");
		init_login();
});

// init_pong();
</script>