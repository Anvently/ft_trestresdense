<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Matchmaking</title>
	<style>
		body {
			background-color: var(--bs-body-bg);
			color: var(--bs-body-color);
			height: 100vh;
			display: flex;
			flex-direction: column;
		}

		.container {
		flex-grow: 1;
		display: flex;
		flex-direction: column;
		}

		.lobby-list {
		flex-grow: 1;
		overflow-y: auto;
		margin-bottom: 20px;
		}

		@media (min-width: 1600) {
		.row {
			max-width: 1600px;
			margin-left: auto;
			margin-right: auto;
		}
		}

		.table {
			background-color:  var(--bs-body-bg);
		}

		.tournament {
		border-left: 5px solid #ffc107;
		}

		.side-buttons {
		display: flex;
		flex-direction: row;
		justify-content: space-between;
		margin-top: 20px;
		align-items: flex-end;
		}

		#hostOptions {
		display: flex;
		margin-right: auto;
		flex-direction: row;
		}

		.mainOptions {
		display: flex;
		margin-left: auto;
		flex-direction: row;
		}

		.btn, .form-control {
		border-radius: 2px;
		}

		.modal-content {
		border-radius: 2px;
		}

		td img {
		width: 30px;
		height: 30px;
		margin-right: 10px;
		}

		.user-link {
		color: inherit;
		}

		.user-link img {
		width: 30px;
		height: 30px;
		object-fit: cover;
		}

		.table td {
		vertical-align: middle;
		}

		th.left, td.left {
		text-align: left;
		padding-left: 15px !important;
		}

		th.center, td.center {
		text-align: center;
		}

		th.right, td.right {
		padding-right: 15px !important;
		text-align: right;
		}

		td.center a {
			justify-content: center;
		}

		/* Modifications pour les slots vides */
		tr.text-muted {
			background-color: var(--bs-secondary-bg);  /* Gris plus foncé mais léger */
			color:  var(--bs-secondary-color);  /* Couleur de texte plus foncée */
		}

		tr.text-muted td {
		padding: 10px 8px;
		}

		tr.player-ready td {
			background-color: var(--bs-success);
		}

		/* Effet de survol simplifié pour tous les tr */
		.table-hover tbody tr:hover {
			background-color: var(--bs-secondary-bg);  /* Gris encore plus foncé au survol */
		}

		#invitation {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
		#invitation img {
			width: 200px;
			height: 200px;
		}
        #inviteText {
            background-color: var(--bs-secondary-bg);
            color:  var(--bs-primary);
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 1.1em;
        }
	</style>
</head>
<body>
	<div class="container mt-4" id="mainView">
		<h1 class="mb-4">Matchmaking</h1>
		<div class="row">
			<div class="col-md-6">
				<h2>Availables lobbies</h2>
				<div id="availableLobbies" class="lobby-list">
					<table class="table table-hover">
						<thead>
							<tr>
								<th class="left">Name</th>
								<th class="center">Type</th>
								<th class="center">Host</th>
								<th class="center">Slots</th>
								<th class="right">Action</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td colspan="5">No results.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="col-md-6">
				<h2>Match in progress</h2>
				<div id="ongoingMatches" class="lobby-list">
					<table class="table table-hover">
						<thead>
							<tr>
								<th class="left">Name</th>
								<th class="center">Type</th>
								<th class="center">Host</th>
								<th class="center">Slots</th>
								<th class="right">Action</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td colspan="5">No results.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="row mt-4">
			<div class="col-12">
				<div class="side-buttons">
					<div class="mainOptions">
						<button class="btn btn-primary mainView me-2" data-bs-toggle="modal" data-bs-target="#createLobbyModal">New lobby</button>
						<button class="btn btn-info mainView me-2" data-bs-toggle="modal" data-bs-target="#joinLobbyModal">Join lobby</button>
						<button id='buttonShowOnlinePlayers'class="btn btn-secondary mainView me-2">Online players</button>
					</div>
				</div>
			</div>
		</div>

	</div>

	<div class="container mt-4 d-none" id="lobbyView">
		<h1 class="mb-4">Lobby: <span id="lobbyName"></span></h1>
		<div id="lobbyContainer" class="row">
			<div id="lobbyPlayersTable" class="col-12">
				<table class="table table-hover">
				<thead>
					<tr>
					<th class="left">Player name</th>
					<th class="center">Status</th>
					<th class="right">Action</th>
					</tr>
				</thead>
				<tbody id="playerList">
					<!-- Liste des joueurs insérée ici via WebSocket -->
				</tbody>
				</table>
			</div>
			<div id="localTournamentContainer">
				
			</div>
		</div>
		<div class="row mt-4">
			<div class="col-12">
				<div class="side-buttons">
					<div class="mainOptions">
						<button id="inviteFriendsButton" class="btn btn-secondary lobbyView me-2">Invite friends</button>
						<button id="addLocalPlayerButton" class="btn btn-secondary lobbyView me-2 d-none">Add player</button>
						<button id="getLobbyId" class="btn btn-secondary lobbyView me-2 d-none">My Lobby Id</button>
						<button id="leaveLobbyButton" class="btn btn-danger lobbyView">Leave lobby</button>
						<button id="displayBracketButton" class="btn btn-secondary lobbyView me-2 d-none">Results</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal pour rejoindre un lobby -->
	<div class="modal fade" id="joinLobbyModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Join lobby</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<input type="text" id="lobbyIdInput" class="form-control" placeholder="lobby ID">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button id='joinLobbyButton' type="button" class="btn btn-primary">Join</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="tournamentModal" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Tournament</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" id="tournamentModalDiv">

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal pour créer un lobby -->
	<div class="modal fade" id="createLobbyModal" tabindex="-1" aria-labelledby="createLobbyModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="createLobbyModalLabel">New lobby</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body" style="max-height: 400px; overflow-y: auto;">
					<form id="createLobbyForm">

						<div class="mb-3">
							<label for="gameType" class="form-label">Choose game</label>
							<select id="gameType" class="form-select">
								<option value="pong2d">Pong 2D</option>
								<option value="pong3d">Pong 3D</option>
							</select>
						</div>

						<div class="mb-3">
							<label for="matchType" class="form-label">Lobby type</label>
							<select id="matchType" class="form-select">
								<option value="simple_match">Simple match</option>
								<option value="tournament_lobby">Online tournament</option>
								<option value="local_match">Local match</option>
								<option value="local_tournament_lobby"> Local Tournament</option>
							</select>
						</div>

						<div class="mb-3">
							<label for="lobbyNameCreation" class="form-label">Lobby name</label>
							<input type="text" value="My lobby" id="lobbyNameCreation" class="form-control" required>
						</div>
						<div id="error-message-lobby-name" class="form-errors alert alert-danger" style="display: none;"></div>

						<div class="mb-3">
							<label for="maxPlayers" class="form-label">Number of players</label>
							<select id="maxPlayers" class="form-control" required>
							  <option value="2">2</option>
							  <option value="4">4</option>
							  <option value="8">8</option>
							</select>
						  </div>
						<div id="error-message-max-players" class="form-errors alert alert-danger" style="display: none;"></div>

						<div class="mb-3">
							<label for="botsCount" class="form-label">Number of bots</label>
							<input type="number" value="0" id="botsCount" class="form-control" min="0" max="4" required>
						</div>
						<div id="error-message-nbr-bots" class="form-errors alert alert-danger" style="display: none;"></div>

						<div class="mb-3">
							<label class="form-label">Lobby privacy</label>
							<select id="lobbyPrivacy" class="form-select">
								<option value="public">Public</option>
								<option value="private">Private</option>
							</select>
						</div>

						<div class="mb-3">
							<label class="form-label">Allow spectators</label>
							<select id="spectators" class="form-select">
								<option value="allowed">Allow</option>
								<option value="notAllowed">Deny</option>
							</select>
						</div>

						<div class="mb-3">
							<label for="nbrLives" class="form-label">Number of lives/points to victory</label>
							<input type="number" value="5" id="nbrLives" class="form-control" min="1" max="100" required>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button id="createLobbyButton" type="button" class="btn btn-primary">Create</button>
				  </div>
			</div>
		</div>
	</div>

	<!-- Modal pour afficher les joueurs en ligne -->
	<div class="modal fade" id="displayOnlinePlayersModal" tabindex="-1" aria-labelledby="displayOnlinePlayersModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="displayOnlinePlayersModalLabel"> Online players</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-hover" id="onlinePlayers">
                        <tbody>
                            <!-- La liste des amis sera générée ici par JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

<!-- Modal pour inviter des amis -->
	<div class="modal fade" id="inviteFriendsModal" tabindex="-1" aria-labelledby="inviteFriendsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="inviteFriendsModalLabel">Invite friends</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-hover" id="friendList">
                        <tbody>
                            <!-- La liste des amis sera générée ici par JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

	<!--Modal pour recevoir une invitation-->
	<div class="modal fade" id="receiveInvitation" tabindex="-1" aria-labelledby="receiveInvitationLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="receiveInvitationLabel">Invitation received</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="invitation">
                        <p id="inviteText"></p>
						<img src="/assets/duel.jpg">
						<button id="inviteJoinBtn" class="btn btn-success">Join game</button>
                </div>
            </div>
        </div>
    </div>

		<!--Modal lorsqu'un partie de tournoi va bientot commencer-->
		<div class="modal fade" id="readyUp" tabindex="-1" aria-labelledby="readyUpLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="readyUpLabel">Notification</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div id="readyUpDiv" class="text-center p-4">
							<p id="readyUpText" class="mb-4"></p>
							<div id="readyUpButtonContainer" class="d-flex justify-content-center"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!--Modal pour confirmer qu'on quitte un lobby de tournoi-->
		<div class="modal fade" id="leaveTnLobbyModal" tabindex="-1" aria-labelledby="leaveTnLobbyModalLabel" aria-hidden="true">
			<div class="modal-dialog">
			  <div class="modal-content">
				<div class="modal-header">
				  <h5 class="modal-title" id="leaveTnLobbyModalLabel">Leave Tournament Lobby?</h5>
				</div>
				<div class="modal-body">
				  Are you sure you want to leave the tournament lobby? This action cannot be undone.
				</div>
				<div class="modal-footer">
				  <button type="button" class="btn btn-secondary" id="cancelLeaveBtn">Cancel</button>
				  <button type="button" class="btn btn-danger" id="confirmLeaveBtn">Leave</button>
				</div>
			  </div>
			</div>
		  </div>

		  	<!--Modal lorsqu'un joueur n'a pas rejoint un lobby a temps-->
		<div class="modal fade" id="notShowUp" tabindex="-1" aria-labelledby="notShowUpLabel" aria-hidden="true">
			<div class="modal-dialog">
			  <div class="modal-content">
				<div class="modal-header">
				  <h5 class="modal-title" id="notShowUpLabel">Match canceled</h5>
				</div>
				<div class="modal-body">
					A player failed to show up on time, the match is canceled.
				</div>
				<div class="modal-footer">
				  <button type="button" class="btn btn-danger" id="closeButton">Back to matchmaking</button>
				</div>
			  </div>
			</div>
		  </div>


	<!-- Modal si deja en partie -->
<div class="modal fade" id="inGame" tabindex="-1" aria-labelledby="inGameLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inGameLabel">Notification</h5>
            </div>
            <div class="modal-body p-3">
                <p id="eventText"> You already are in a game !</p>
                <div id="choiceContainer" class="d-flex justify-content-between mt-3">
                    <button type="button" class="btn btn-primary" id="rejoinButton">Join</button>
                    <button type="button" class="btn btn-secondary" id="concedeButton">Concede</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="nicknameModal" tabindex="-1" aria-labelledby="nicknameModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="nicknameModalLabel">Enter Your Nickname</h5>
		</div>
		<div class="modal-body p-3">
		  <form id="nicknameForm" onsubmit="return false;">
			<div class="mb-3">
			  <input type="text"
					 id="nicknameInput"
					 class="form-control"
					 placeholder="Enter your nickname (1-15 characters)"
					 autocomplete="off"
					 maxlength="15"
					 pattern="[A-Za-z0-9]+"
					 required>
			  <div id="nicknameError" class="invalid-feedback"></div>
			  <small class="form-text text-muted">Only letters and numbers allowed</small>
			</div>
			<button type="submit" class="btn btn-primary" id="submitNicknameButton">Submit</button>
		  </form>
		</div>
	  </div>
	</div>
  </div>

</body>
</html>





